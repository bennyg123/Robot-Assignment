import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';
import { RobotStateService } from 'src/app/services/robot-state.service';
import { SuccessMessage, Report, Direction, Robot } from 'src/app/classes/robot';

@Component({
  selector: 'app-game-board',
  templateUrl: './game-board.component.html',
  styleUrls: ['./game-board.component.css']
})
export class GameBoardComponent implements OnInit {

  @ViewChild('myCanvas') myCanvas: ElementRef;
  private 
    context: CanvasRenderingContext2D;
    robotNImage : any;
    robotSImage : any;
    robotEImage : any;
    robotWImage : any;

  constructor(private robotStateService : RobotStateService) { 
    this.robotNImage = new Image();
    this.robotEImage = new Image();
    this.robotSImage = new Image();
    this.robotWImage = new Image();

    this.robotNImage.src = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjUwcHQiIGhlaWdodD0iNTMycHQiIHZpZXdCb3g9IjAgMCA2NTAgNTMyIiB2ZXJzaW9uPSIxLjIiPgo8ZyBpZD0ic3VyZmFjZTMxMjAwNiI+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDUwIDUwIEwgNTAgNTAwIEwgNjAwIDUwMCBMIDYwMCA1MCBMIDUwIDUwICIvPgo8cGF0aCBzdHlsZT0iZmlsbDpub25lO3N0cm9rZS13aWR0aDo1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2U6cmdiKDAlLDAlLDAlKTtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjEwOyIgZD0iTSAxMjUgMzI1IEwgMTI1IDQyNSBMIDIyNSA0MjUgTCAyMjUgMzI1IEwgMTI1IDMyNSAiLz4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gNDI1IDMyNSBMIDQyNSA0MjUgTCA1MjUgNDI1IEwgNTI1IDMyNSBMIDQyNSAzMjUgIi8+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDI3NSA0MjUgTCAzMjUgNDc1IEwgMzc1IDQyNSBMIDI3NSA0MjUgIi8+CjwvZz4KPC9zdmc+Cg==";
    this.robotEImage.src = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjUwcHQiIGhlaWdodD0iNTMycHQiIHZpZXdCb3g9IjAgMCA2NTAgNTMyIiB2ZXJzaW9uPSIxLjIiPgo8ZyBpZD0ic3VyZmFjZTIzNjIxMiI+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDUwIDUwIEwgNTAgNTAwIEwgNjAwIDUwMCBMIDYwMCA1MCBMIDUwIDUwICIvPgo8cGF0aCBzdHlsZT0iZmlsbDpub25lO3N0cm9rZS13aWR0aDo1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2U6cmdiKDAlLDAlLDAlKTtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjEwOyIgZD0iTSA0MjUgMTAwIEwgNDI1IDIwMCBMIDUyNSAyMDAgTCA1MjUgMTAwIEwgNDI1IDEwMCAiLz4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gNDI1IDM1MCBMIDQyNSA0NTAgTCA1MjUgNDUwIEwgNTI1IDM1MCBMIDQyNSAzNTAgIi8+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDUyNSAyMjUgTCA1NzUgMjc1IEwgNTI1IDMyNSBMIDUyNSAyMjUgIi8+CjwvZz4KPC9zdmc+Cg==";
    this.robotSImage.src = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjUwcHQiIGhlaWdodD0iNTMycHQiIHZpZXdCb3g9IjAgMCA2NTAgNTMyIiB2ZXJzaW9uPSIxLjIiPgo8ZyBpZD0ic3VyZmFjZTg2MjI1Ij4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gNTAgNTAgTCA1MCA1MDAgTCA2MDAgNTAwIEwgNjAwIDUwIEwgNTAgNTAgIi8+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDEyNSAxMjUgTCAxMjUgMjI1IEwgMjI1IDIyNSBMIDIyNSAxMjUgTCAxMjUgMTI1ICIvPgo8cGF0aCBzdHlsZT0iZmlsbDpub25lO3N0cm9rZS13aWR0aDo1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2U6cmdiKDAlLDAlLDAlKTtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjEwOyIgZD0iTSA0MjUgMTI1IEwgNDI1IDIyNSBMIDUyNSAyMjUgTCA1MjUgMTI1IEwgNDI1IDEyNSAiLz4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gMjc1IDEyNSBMIDMyNSA3NSBMIDM3NSAxMjUgTCAyNzUgMTI1ICIvPgo8L2c+Cjwvc3ZnPgo=";
    this.robotWImage.src = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNjUwcHQiIGhlaWdodD0iNTMycHQiIHZpZXdCb3g9IjAgMCA2NTAgNTMyIiB2ZXJzaW9uPSIxLjIiPgo8ZyBpZD0ic3VyZmFjZTQyMzk5NyI+CjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlLXdpZHRoOjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTpyZ2IoMCUsMCUsMCUpO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLW1pdGVybGltaXQ6MTA7IiBkPSJNIDUwIDUwMCBMIDUwIDUwIEwgNjAwIDUwIEwgNjAwIDUwMCBMIDUwIDUwMCAiLz4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gMTI1IDQyNSBMIDEyNSA0NTAgTCAyMjUgNDUwIEwgMjI1IDM1MCBMIDEyNSAzNTAgTCAxMjUgNDI1ICIvPgo8cGF0aCBzdHlsZT0iZmlsbDpub25lO3N0cm9rZS13aWR0aDo1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2U6cmdiKDAlLDAlLDAlKTtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1taXRlcmxpbWl0OjEwOyIgZD0iTSAxMjUgMTAwIEwgMTI1IDIwMCBMIDIyNSAyMDAgTCAyMjUgMTAwIEwgMTI1IDEwMCAiLz4KPHBhdGggc3R5bGU9ImZpbGw6bm9uZTtzdHJva2Utd2lkdGg6NTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOnJnYigwJSwwJSwwJSk7c3Ryb2tlLW9wYWNpdHk6MTtzdHJva2UtbWl0ZXJsaW1pdDoxMDsiIGQ9Ik0gMTI1IDMyNSBMIDc1IDI3NSBMIDEyNSAyMjUgTCAxMjUgMzI1ICIvPgo8L2c+Cjwvc3ZnPgo=";
    
    this.robotStateService.successEmitter.subscribe(()=> {
      let robotReport : Report = this.robotStateService.getReport();

      this.context.clearRect(0,0,500,500);
      this.context.moveTo(0,0);
      this.context.drawImage(this.getRotationRobot(robotReport.dir), robotReport.x*100 , robotReport.y*100 , 100, 100);

    });
  }

  getRotationRobot(dir : Direction) { 
    switch(dir) {
      case Direction.North: return this.robotNImage;
      case Direction.East: return this.robotEImage;
      case Direction.South: return this.robotSImage;
      case Direction.West: return this.robotWImage;
    }
  }

  ngOnInit() {
  }

  ngAfterViewInit(): void {
    this.context = (<HTMLCanvasElement>this.myCanvas.nativeElement).getContext('2d');
    this.context.transform(1, 0, 0, -1, 0, 500)
  }

}
